# ğŸš€ åä¸ºäº‘éƒ¨ç½²å¿«é€ŸæŒ‡å—

## âœ… å½“å‰çŠ¶æ€
ä½ çš„APIå·²åœ¨æœ¬åœ°æˆåŠŸè¿è¡Œï¼æ¥ä¸‹æ¥éƒ¨ç½²åˆ°åä¸ºäº‘ã€‚

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šè´­ä¹°åä¸ºäº‘ECSæœåŠ¡å™¨

1. **ç™»å½•åä¸ºäº‘æ§åˆ¶å°**
   - è®¿é—®: https://console.huaweicloud.com
   - ç™»å½•ä½ çš„åä¸ºäº‘è´¦å·

2. **åˆ›å»ºECSå®ä¾‹**
   - è¿›å…¥ "å¼¹æ€§äº‘æœåŠ¡å™¨ ECS"
   - ç‚¹å‡» "è´­ä¹°å¼¹æ€§äº‘æœåŠ¡å™¨"
   - **æ¨èé…ç½®**:
     - è®¡è´¹æ¨¡å¼: æŒ‰éœ€è®¡è´¹
     - è§„æ ¼: é€šç”¨è®¡ç®—å‹ s6.large.2 (2æ ¸4GB)
     - é•œåƒ: Ubuntu Server 20.04 LTS 64bit
     - ç³»ç»Ÿç›˜: 40GB é«˜IO
     - ç½‘ç»œ: é€‰æ‹©é»˜è®¤VPCå’Œå­ç½‘
     - å®‰å…¨ç»„: å…ˆä½¿ç”¨é»˜è®¤ï¼Œç¨åé…ç½®
     - å¼¹æ€§å…¬ç½‘IP: è‡ªåŠ¨åˆ†é…
     - ç™»å½•å‡­è¯: å¯†é’¥å¯¹(æ¨è)æˆ–å¯†ç 

3. **é…ç½®å®‰å…¨ç»„**
   - è¿›å…¥ "ç½‘ç»œ > å®‰å…¨ç»„"
   - ç¼–è¾‘ä½ çš„ECSå®ä¾‹å®‰å…¨ç»„
   - **æ·»åŠ å…¥æ–¹å‘è§„åˆ™**:
     ```
     åè®®ç«¯å£: TCP 5000
     æºåœ°å€: 0.0.0.0/0
     æè¿°: ç³–å°¿ç—…é¢„æµ‹APIç«¯å£
     ```
   - **æ·»åŠ SSHè§„åˆ™**(å¦‚æœæ²¡æœ‰):
     ```
     åè®®ç«¯å£: TCP 22
     æºåœ°å€: 0.0.0.0/0 (ç”Ÿäº§ç¯å¢ƒå»ºè®®é™åˆ¶ä¸ºä½ çš„IP)
     æè¿°: SSHè¿œç¨‹è¿æ¥
     ```

### ç¬¬äºŒæ­¥ï¼šè¿æ¥åˆ°æœåŠ¡å™¨

**Windowsç”¨æˆ· - ä½¿ç”¨PowerShell:**
```powershell
ssh ubuntu@ä½ çš„æœåŠ¡å™¨å…¬ç½‘IP
```

**ç¬¬ä¸€æ¬¡è¿æ¥é€‰æ‹©yesç¡®è®¤æŒ‡çº¹**

### ç¬¬ä¸‰æ­¥ï¼šæœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…å¿…éœ€è½¯ä»¶
sudo apt install python3 python3-pip python3-venv git curl -y

# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir ~/diabetes_prediction
cd ~/diabetes_prediction

# åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ(æ¨è)
python3 -m venv venv
source venv/bin/activate
```

### ç¬¬å››æ­¥ï¼šä¸Šä¼ é¡¹ç›®æ–‡ä»¶

**æ–¹æ³•1: ä½¿ç”¨scp (æ¨è)**
åœ¨æœ¬åœ°å¦å¼€ä¸€ä¸ªç»ˆç«¯çª—å£:
```powershell
# åˆ‡æ¢åˆ°ä½ çš„é¡¹ç›®ç›®å½•
cd "D:\data process homework\Data-Analysis-and-Data-Mining\Final Project Test"

# ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
scp app.py ubuntu@ä½ çš„æœåŠ¡å™¨IP:~/diabetes_prediction/
scp xgboost_model.pkl ubuntu@ä½ çš„æœåŠ¡å™¨IP:~/diabetes_prediction/
scp requirements.txt ubuntu@ä½ çš„æœåŠ¡å™¨IP:~/diabetes_prediction/
scp start.sh ubuntu@ä½ çš„æœåŠ¡å™¨IP:~/diabetes_prediction/
```

**æ–¹æ³•2: ä½¿ç”¨WinSCPè½¯ä»¶**
- ä¸‹è½½å®‰è£…WinSCP
- è¿æ¥åˆ°æœåŠ¡å™¨
- ä¸Šä¼ ä»¥ä¸‹æ–‡ä»¶åˆ° `/home/ubuntu/diabetes_prediction/` ç›®å½•:
  - app.py
  - xgboost_model.pkl
  - requirements.txt  
  - start.sh

### ç¬¬äº”æ­¥ï¼šæœåŠ¡å™¨éƒ¨ç½²

å›åˆ°æœåŠ¡å™¨SSHè¿æ¥çª—å£:
```bash
cd ~/diabetes_prediction

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å®‰è£…Pythonä¾èµ–
pip install -r requirements.txt

# ç»™å¯åŠ¨è„šæœ¬æ‰§è¡Œæƒé™
chmod +x start.sh

# æµ‹è¯•è¿è¡Œ
python app.py
```

çœ‹åˆ° "APIæœåŠ¡å¯åŠ¨æˆåŠŸ!" åï¼ŒæŒ‰ Ctrl+C åœæ­¢æµ‹è¯•ã€‚

### ç¬¬å…­æ­¥ï¼šç”Ÿäº§ç¯å¢ƒå¯åŠ¨

```bash
# ä½¿ç”¨gunicornå¯åŠ¨(ç”Ÿäº§ç¯å¢ƒ)
./start.sh
```

å¦‚æœçœ‹åˆ°ç±»ä¼¼è¾“å‡ºè¡¨ç¤ºæˆåŠŸ:
```
[INFO] Starting gunicorn 21.2.0
[INFO] Listening at: http://0.0.0.0:5000
[INFO] Using worker: sync
[INFO] Booted worker pid: xxxx
```

### ç¬¬ä¸ƒæ­¥ï¼šæµ‹è¯•éƒ¨ç½²

**åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•:**
```bash
curl http://localhost:5000/health
```

**åœ¨æœ¬åœ°æµ‹è¯•:**
```powershell
# æµ‹è¯•APIä¸»é¡µ(æ›¿æ¢ä¸ºä½ çš„æœåŠ¡å™¨IP)
Invoke-WebRequest -Uri "http://ä½ çš„æœåŠ¡å™¨IP:5000/" -Method GET

# æˆ–è€…ä½¿ç”¨Pythonæµ‹è¯•è„šæœ¬
python test_local.py http://ä½ çš„æœåŠ¡å™¨IP:5000
```

### ç¬¬å…«æ­¥ï¼šé…ç½®å¼€æœºè‡ªå¯åŠ¨(å¯é€‰)

```bash
sudo nano /etc/systemd/system/diabetes-api.service
```

æ·»åŠ ä»¥ä¸‹å†…å®¹:
```ini
[Unit]
Description=Diabetes Prediction API
After=network.target

[Service]
Type=exec
User=ubuntu
WorkingDirectory=/home/ubuntu/diabetes_prediction
Environment=PATH=/home/ubuntu/diabetes_prediction/venv/bin
ExecStart=/home/ubuntu/diabetes_prediction/venv/bin/gunicorn -w 4 -b 0.0.0.0:5000 app:app --timeout 120
Restart=always

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡:
```bash
sudo systemctl daemon-reload
sudo systemctl start diabetes-api
sudo systemctl enable diabetes-api
sudo systemctl status diabetes-api
```

## ğŸ¯ APIä½¿ç”¨ç¤ºä¾‹

éƒ¨ç½²æˆåŠŸåï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨API:

### å¥åº·æ£€æŸ¥
```bash
curl http://ä½ çš„æœåŠ¡å™¨IP:5000/health
```

### å•ä¸ªé¢„æµ‹
```bash
curl -X POST http://ä½ çš„æœåŠ¡å™¨IP:5000/predict \
  -H "Content-Type: application/json" \
  -d '{
    "age": 45,
    "gender": "male",
    "bmi": 28.5,
    "HbA1c_level": 6.5,
    "blood_glucose_level": 140,
    "smoking_history": "former",
    "hypertension": 1,
    "heart_disease": 0
  }'
```

### æ‰¹é‡é¢„æµ‹
```bash
curl -X POST http://ä½ çš„æœåŠ¡å™¨IP:5000/predict_batch \
  -H "Content-Type: application/json" \
  -d '{
    "data": [
      {
        "age": 35,
        "gender": "female",
        "bmi": 22.0,
        "HbA1c_level": 5.0,
        "blood_glucose_level": 100,
        "smoking_history": "never",
        "hypertension": 0,
        "heart_disease": 0
      }
    ]
  }'
```

## ğŸ”§ ç»´æŠ¤å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status diabetes-api

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u diabetes-api -f

# é‡å¯æœåŠ¡
sudo systemctl restart diabetes-api

# åœæ­¢æœåŠ¡
sudo systemctl stop diabetes-api
```

## â— å¸¸è§é—®é¢˜

### 1. æ— æ³•è®¿é—®API
- æ£€æŸ¥å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾5000ç«¯å£
- æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ: `ps aux | grep gunicorn`

### 2. æ¨¡å‹åŠ è½½å¤±è´¥
- ç¡®è®¤ `xgboost_model.pkl` æ–‡ä»¶å·²ä¸Šä¼ ä¸”å¤§å°ä¸º337KB
- æ£€æŸ¥æ–‡ä»¶æƒé™: `ls -la xgboost_model.pkl`

### 3. å†…å­˜ä¸è¶³
- å‡çº§ECSå®ä¾‹è§„æ ¼
- æˆ–å‡å°‘workeræ•°é‡: ä¿®æ”¹start.shä¸­çš„ `-w 4` ä¸º `-w 2`

## ğŸ‰ éƒ¨ç½²å®Œæˆ

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œä½ çš„XGBoostç³–å°¿ç—…é¢„æµ‹APIå°±æˆåŠŸéƒ¨ç½²åˆ°åä¸ºäº‘äº†ï¼

**ä½ çš„APIåœ°å€:** http://ä½ çš„æœåŠ¡å™¨IP:5000

ç°åœ¨ä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªåœ°å€ä½¿ç”¨ä½ çš„ç³–å°¿ç—…é¢„æµ‹æœåŠ¡äº†ï¼ 